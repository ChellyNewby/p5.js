<html>

<head>

   
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.5/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.5/addons/p5.dom.js"></script>
    <script src="../libraries/p5.speech.js"></script>

    <script>
        var sonnets;
        var poemString;
        var lang= navigator.language || 'en-US';
        let readPoem = new p5.Speech('Microsoft Zira Desktop - English (United States)');
        var ownPoem = new p5.SpeechRec(lang); 
         
        ownPoem.onResult=resultRecord;
        
     
        var speakbutton; // UI
        var song;
        var playing=true;
        var read;
        

        function setup() {
            background(128);
            createCanvas(windowWidth, windowHeight);
            noLoop();
           
            loadJSON('data/Shakespeare.json', loadPoem);
           
        }





        function loadPoem(data) {
            // The JSON is now in data!
            
           
            sonnets = data;
            
            background('#222222');
            
            
            fill(255, 204, 100);
            textFont('Georgia'); 
            textSize(60); 
            textStyle(ITALIC);
            text("Will.I.Am", (windowWidth / 4)+120, (windowHeight / 2)-100);
            
            textSize(40); 
            textStyle(NORMAL);
            text("Press 'R' to record your own poem", windowWidth / 4, windowHeight / 2);
            text("Press 'W' to hear a Shakespeare poem", windowWidth / 4, (windowHeight / 2)+40);
             text("Press the spacebar to read or stop reading the poem", windowWidth / 4, (windowHeight / 2)+80);
              
            
             

            }
        
        
        




            function printPoem() {
                background(0);
                var i = floor(random(0, 152));

                typeWriter(sonnets[i].title, 0,windowWidth / 4, 50, 100);
                typeWriter(sonnets[i].author, 0, windowWidth / 4, 70, 100);

                var count = 120;
                var arr1 = new Array(sonnets[i].title, sonnets[i].author);
                poemT = join(arr1, "");
                var poems = sonnets[i].lines;

                readPoem.speak(poemT);

                poemString = join(poems," ");
               


                for (var s = 0; s < 14; s++) {
                    typeWriter(sonnets[i].lines[s], 0, windowWidth / 4, count, 100);
                    count += 35;

                }


            }
        
        
        function recordPoem(){
            background('#222222');
            speakbutton = createButton('Start Recording');
  		    speakbutton.position( windowWidth / 3, 300);
           
  		    speakbutton.mousePressed(doSpeak);
            
            
        }
        
        function doSpeak(){
            speakbutton.remove();
            background('#222222');
            
            ownPoem.onResult=resultRecord;
            ownPoem.start(true,false);
        }
        
        function resultRecord(){
            if(ownPoem.resultValue){
                var myDiv= createDiv(ownPoem.resultString);
                myDiv.position(windowWidth / 3,100);
                myDiv.style("font-family",'Consolas');
                myDiv.style("font-size","18px");
                myDiv.style("color", "#fff");
                
        
             typeWriter("Press 'S' to save text file of your poem", 0,windowWidth / 4, 50, 100);
                
                
            }
            
        }

            function keyPressed() {
                if (key == "W" || key == "w") {
                    read=true;
                    printPoem();
                }
                
                if (key=="R" || key=="r")
                    {   
                        read=false;
                        recordPoem();
                    }
                
                
                if (read){
                
                if(key==" ")
                    if (playing){
                    readPoem.speak(poemString);
                    playing=false;
                    }
                    else {
                        readPoem.stop();
                        playing=true;
                    }
                    
                }
                
                if (!read){
                    if (key=="S" || key=="s")
                        save(ownPoem.resultString, 'yourpoem.txt');
                }
            
            }

            function mousePressed() {
                
                if (read){

                readPoem.speak(poemString);
            }
            }



            function doList() {
                readPoem.listVoices();

            }

            function draw() {
                
            }

            function typeWriter(sentence, n, x, y, speed) {

                if (n < (sentence.length)) {
                    fill("#fff");
                    textFont('Consolas');
                    textSize(20);
                    text(sentence.substring(0, n + 1), x, y, );
                    n++;
                    setTimeout(function() {
                        typeWriter(sentence, n, x, y, speed)
                    }, speed);
                }
            }

    </script>
</head>

<body>
</body>

</html>
